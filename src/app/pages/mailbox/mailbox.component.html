<section class="section">
  <div class="container-fluid">
    <div class="row row-cols-2 g-2">
      <div class="col-md-2 col-sm-5 sidebar">
        <div class="user-container d-flex justify-content-center align-items-center mt-4">
          <div class=" img-container">
            <img class="profile-picture" src="../../../assets/profile-picture.webp" alt="Profile Picture">
          </div>
          <div class=" user-info">
            <h1 class="user-name mb-0"> Javier Mart√≠nez </h1>
            <small class="email text-muted">javiermartinez&commat;lucentialab.es</small>
          </div>
        </div>
        <div class="btn-container  d-flex justify-content-center">
          <button class="btn compose-btn m-4"><i class="me-1 bi bi-plus"></i> Compose </button>
        </div>
        <div class="list-container">
          <div>
            <h3> Mailboxes </h3>
          </div>
          <ul class="list-unstyled mt-4">
            <li class="nav-item d-flex flex-row justify-content-between align-items-center" role="button"
              [ngClass]="{'active': showInbox}" (click)="toggleShowInbox()">
              <div class="left-container d-flex align-items-center">
                <i class="me-3 bi bi-inbox"></i> Inbox
                <span *ngIf="unreadedCount > 0" class=" ms-3 badge bg-danger rounded-pill"> {{unreadedCount}} </span>
              </div>
              <div class="right-container text-end">
                <span>{{mails.length}}</span>
              </div>
            </li>
            <li [ngClass]="{'active': activeNavItem === 'Sent'}" class="nav-item"><a role="button"><i
                  class="me-3 bi bi-send"></i> Sent </a></li>
            <li [ngClass]="{'active': activeNavItem === 'Drafts'}" class="nav-item"><a role="button"><i
                  class="me-3 bi bi-file-earmark"></i> Drafts </a></li>
            <li [ngClass]="{'active': showSpam}"
              class="nav-item d-flex flex-row justify-content-between align-items-center" (click)="toggleShowSpam()">
              <span><i class="me-3 bi bi-exclamation-triangle"></i> Spam </span>
              <span *ngIf="spamMails.length > 0"> {{spamMails.length}}</span>
            </li>
            <li [ngClass]="{'active': showTrash}"
              class="nav-item d-flex flex-row justify-content-between align-items-center" (click)="toggleShowTrash()">
              <span><i class="me-3 bi bi-trash3"></i> Trash </span>
              <span *ngIf="trashMails.length > 0"> {{trashMails.length}}</span>
            </li>
          </ul>
        </div>
        <div class="list-container">
          <div class="title">
            <h3> Filters </h3>
          </div>
          <ul class="list-unstyled mt-4">
            <li [ngClass]="{'active': showStarred}"
              class="nav-item d-flex flex-row justify-content-between align-items-center" (click)="toggleShowStarred()">
              <span><i class="me-3 bi bi-star"></i> Starred </span>
              <span> {{starredMails.length}}</span>
            </li>
            <li [ngClass]="{'active': showImportant}"
              class="nav-item d-flex flex-row justify-content-between align-items-center"
              (click)="toggleShowImportant()">
              <span><i class="me-3 bi bi-exclamation-circle"></i> Important </span>
              <span *ngIf="importantMails.length > 0"> {{importantMails.length}}</span>
            </li>
          </ul>
        </div>
        <div class="list-container">
          <div>
            <h3> Labels </h3>
          </div>
          <ul class="list-unstyled mt-4">
            <li [ngClass]="{'active': showSocial}"
              class="nav-item d-flex flex-row justify-content-between align-items-center" (click)="toggleShowSocial()">
              <span><i class="me-3 bi bi-tag text-info"></i> Social </span>
              <span *ngIf="socialMails.length > 0"> {{socialMails.length}}</span>
            </li>
            <li [ngClass]="{'active': showPersonal}"
              class="nav-item d-flex flex-row justify-content-between align-items-center"
              (click)="toggleShowPersonal()">
              <span><i class="me-3 bi bi-tag text-primary"></i> Personal </span>
              <span *ngIf="personalMails.length > 0"> {{personalMails.length}}</span>
            </li>
            <li [ngClass]="{'active': showPromotions}"
              class="nav-item d-flex flex-row justify-content-between align-items-center"
              (click)="toggleShowPromotions()">
              <span><i class="me-3 bi bi-tag text-success"></i> Promotions </span>
              <span *ngIf="promotionsMails.length > 0"> {{promotionsMails.length}}</span>
            </li>
            <li [ngClass]="{'active': showForums}"
              class="nav-item d-flex flex-row justify-content-between align-items-center" (click)="toggleShowForums()">
              <span><i class="me-3 bi bi-tag text-warning"></i> Forums </span>
              <span *ngIf="forumsMails.length > 0"> {{forumsMails.length}}</span>
            </li>
            <li class="nav-item"><a role="button"> <i class="me-3 bi bi-gear"></i> Settings </a></li>
          </ul>
        </div>
      </div>
      <div class="col-md-3 sol-sm-8 ">
        <div class="card mt-2">
          <div class="card-body">
            <!-- SearchBar -->
            <div class="d-flex justify-content-between align-items-center">
              <div class="input-container ">
                <label for="searchInput" class="search-icon">
                  <i class="bi bi-search"></i>
                </label>
                <input pInputText type="text" id="searchInput" class="filter-input form-control"
                  placeholder="Search keyword" />
              </div>
              <div>
                <button (click)="markAllAsRead()" [disabled]="unreadedCount === 0" type="button" class="btn"><i
                    class="bi" [ngClass]="{
                  'bi-envelope-open': unreadedCount > 0,
                  'bi-envelope': unreadedCount === 0
                }"></i></button>
              </div>
            </div>

            <div class="msg-container mt-4">

              <!-- Inbox -->
              <div *ngIf="showInbox" class="row messages-container w-100">
                <div *ngFor="let mail of mails" class="col-12 py-3 pe-3" (click)="selectMail(mail)"
                  [class.selected]="selectedMail === mail">
                  <div class="user d-flex justify-content-between align-items-center">
                    <div class="read-badge d-flex gap-1 justify-content-center align-items-center">
                      <button *ngIf="!mail.readed" (click)="markAsRead()" type="button" class="btn unreaded"
                        [pTooltip]="'Mark as read'" tooltipPosition="bottom"><span pBadge
                          style="font-size: 2px;"></span></button>
                      <button (click)="markAsUnread()" *ngIf="mail.readed" type="button" class="btn readed"
                        [pTooltip]="'Mark as unread'" tooltipPosition="bottom"><span pBadge style="font-size: 2px;"
                          severity="success"></span></button>
                      <h2 class="mb-1 title"> {{mail.title}} </h2>
                    </div>
                    <div class="d-flex justify-content-end align-items-center gap-3 mb-1">
                      <i *ngIf="mail.starred" class="bi bi-star-fill star"></i>
                      <i *ngIf="mail.important" class="bi bi-exclamation-circle important"></i>
                      <small class="text-muted date"> {{mail.timestamp}} </small>
                    </div>
                  </div>
                  <div class="msg-info">
                    <div class="msg-title">
                      <h4> {{mail.sender}} </h4>
                    </div>
                    <div class="msg-content">
                      <p> {{mail.message}} </p>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Spam -->
              <div *ngIf="showSpam" class="row messages-container w-100">
                <div *ngFor="let mail of spamMails" class="col-12 py-3 pe-3" (click)="selectMail(mail)"
                  [class.selected]="selectedMail === mail">
                  <div class="user d-flex justify-content-between align-items-center">
                    <div class="read-badge d-flex gap-1 justify-content-center align-items-center">
                      <button *ngIf="!mail.readed" (click)="markAsRead()" type="button" class="btn unreaded"
                        [pTooltip]="'Mark as read'" tooltipPosition="bottom"><span pBadge
                          style="font-size: 2px;"></span></button>
                      <button (click)="markAsUnread()" *ngIf="mail.readed" type="button" class="btn readed"
                        [pTooltip]="'Mark as unread'" tooltipPosition="bottom"><span pBadge style="font-size: 2px;"
                          severity="success"></span></button>
                      <h2 class="mb-1 title"> {{mail.title}} </h2>
                    </div>

                    <div class="d-flex align-items-center gap-3">
                      <i *ngIf="mail.starred" class="bi bi-star-fill star"></i>
                      <i *ngIf="mail.important" class="bi bi-exclamation-circle important"></i>
                      <span class="text-muted date"> {{mail.timestamp}} </span>
                    </div>
                  </div>
                  <div class="msg-title">
                    <h4> {{mail.sender}} </h4>
                  </div>
                  <div class="msg-content">
                    <p> {{mail.message}} </p>
                  </div>
                </div>
              </div>

              <!-- Trash -->
              <div *ngIf="showTrash" class="row messages-container w-100">
                <div *ngFor="let mail of trashMails" class="col-12 py-3 pe-3" (click)="selectMail(mail)"
                  [class.selected]="selectedMail === mail">
                  <div class="user d-flex justify-content-between align-items-center">
                    <div class="read-badge d-flex gap-1 justify-content-center align-items-center">
                      <button *ngIf="!mail.readed" (click)="markAsRead()" type="button" class="btn unreaded"
                        [pTooltip]="'Mark as read'" tooltipPosition="bottom"><span pBadge
                          style="font-size: 2px;"></span></button>
                      <button (click)="markAsUnread()" *ngIf="mail.readed" type="button" class="btn readed"
                        [pTooltip]="'Mark as unread'" tooltipPosition="bottom"><span pBadge style="font-size: 2px;"
                          severity="success"></span></button>
                      <h2 class="mb-1 title"> {{mail.title}} </h2>
                    </div>

                    <div class="d-flex align-items-center gap-3">
                      <i *ngIf="mail.starred" class="bi bi-star-fill star"></i>
                      <i *ngIf="mail.important" class="bi bi-exclamation-circle important"></i>
                      <span class="text-muted date"> {{mail.timestamp}} </span>
                    </div>
                  </div>
                  <div class="msg-title">
                    <h4> {{mail.sender}} </h4>
                  </div>
                  <div class="msg-content">
                    <p> {{mail.message}} </p>
                  </div>
                </div>
              </div>

              <!-- Filters -->
              <div *ngIf="showStarred" class="row messages-container w-100">
                <div *ngFor="let mail of starredMails" class="col-12 py-3 pe-3" (click)="selectMail(mail)"
                  [class.selected]="selectedMail === mail">
                  <div class="user d-flex justify-content-between align-items-center">
                    <div class="read-badge d-flex gap-1 justify-content-center align-items-center">
                      <button *ngIf="!mail.readed" (click)="markAsRead()" type="button" class="btn unreaded"
                        [pTooltip]="'Mark as read'" tooltipPosition="bottom"><span pBadge
                          style="font-size: 2px;"></span></button>
                      <button (click)="markAsUnread()" *ngIf="mail.readed" type="button" class="btn readed"
                        [pTooltip]="'Mark as unread'" tooltipPosition="bottom"><span pBadge style="font-size: 2px;"
                          severity="success"></span></button>
                      <h2 class="mb-1 title"> {{mail.title}} </h2>
                    </div>

                    <div class="d-flex align-items-center gap-3">
                      <i *ngIf="mail.starred" class="bi bi-star-fill star"></i>
                      <i *ngIf="mail.important" class="bi bi-exclamation-circle important"></i>
                      <span class="text-muted date"> {{mail.timestamp}} </span>
                    </div>
                  </div>
                  <div class="msg-title">
                    <h4> {{mail.sender}} </h4>
                  </div>
                  <div class="msg-content">
                    <p> {{mail.message}} </p>
                  </div>
                </div>
              </div>
              <div *ngIf="showImportant" class="row messages-container w-100">
                <div *ngFor="let mail of importantMails" class="col-12 py-3 pe-3" (click)="selectMail(mail)"
                  [class.selected]="selectedMail === mail">
                  <div class="user d-flex justify-content-between align-items-center">
                    <div class="read-badge d-flex gap-1 justify-content-center align-items-center">
                      <button *ngIf="!mail.readed" (click)="markAsRead()" type="button" class="btn unreaded"
                        [pTooltip]="'Mark as read'" tooltipPosition="bottom"><span pBadge
                          style="font-size: 2px;"></span></button>
                      <button (click)="markAsUnread()" *ngIf="mail.readed" type="button" class="btn readed"
                        [pTooltip]="'Mark as unread'" tooltipPosition="bottom"><span pBadge style="font-size: 2px;"
                          severity="success"></span></button>
                      <h2 class="mb-1 title"> {{mail.title}} </h2>
                    </div>

                    <div class="d-flex align-items-center gap-3">
                      <i *ngIf="mail.starred" class="bi bi-star-fill star"></i>
                      <i *ngIf="mail.important" class="bi bi-exclamation-circle important"></i>
                      <span class="text-muted date"> {{mail.timestamp}} </span>
                    </div>
                  </div>
                  <div class="msg-title">
                    <h4> {{mail.sender}} </h4>
                  </div>
                  <div class="msg-content">
                    <p> {{mail.message}} </p>
                  </div>
                </div>
              </div>

              <!-- Labels -->
              <div *ngIf="showSocial" class="row messages-container w-100">
                <div *ngFor="let mail of socialMails" class="col-12 py-3 pe-3" (click)="selectMail(mail)"
                  [class.selected]="selectedMail === mail">
                  <div class="user d-flex justify-content-between align-items-center">
                    <div class="read-badge d-flex gap-1 justify-content-center align-items-center">
                      <button *ngIf="!mail.readed" (click)="markAsRead()" type="button" class="btn unreaded"
                        [pTooltip]="'Mark as read'" tooltipPosition="bottom"><span pBadge
                          style="font-size: 2px;"></span></button>
                      <button (click)="markAsUnread()" *ngIf="mail.readed" type="button" class="btn readed"
                        [pTooltip]="'Mark as unread'" tooltipPosition="bottom"><span pBadge style="font-size: 2px;"
                          severity="success"></span></button>
                      <h2 class="mb-1 title"> {{mail.title}} </h2>
                    </div>

                    <div class="d-flex align-items-center gap-3">
                      <i *ngIf="mail.starred" class="bi bi-star-fill star"></i>
                      <i *ngIf="mail.important" class="bi bi-exclamation-circle important"></i>
                      <span class="text-muted date"> {{mail.timestamp}} </span>
                    </div>
                  </div>
                  <div class="msg-title">
                    <h4> {{mail.sender}} </h4>
                  </div>
                  <div class="msg-content">
                    <p> {{mail.message}} </p>
                  </div>
                </div>
              </div>
              <div *ngIf="showPersonal" class="row messages-container w-100">
                <div *ngFor="let mail of personalMails" class="col-12 py-3 pe-3" (click)="selectMail(mail)"
                  [class.selected]="selectedMail === mail">
                  <div class="user d-flex justify-content-between align-items-center">
                    <div class="read-badge d-flex gap-1 justify-content-center align-items-center">
                      <button *ngIf="!mail.readed" (click)="markAsRead()" type="button" class="btn unreaded"
                        [pTooltip]="'Mark as read'" tooltipPosition="bottom"><span pBadge
                          style="font-size: 2px;"></span></button>
                      <button (click)="markAsUnread()" *ngIf="mail.readed" type="button" class="btn readed"
                        [pTooltip]="'Mark as unread'" tooltipPosition="bottom"><span pBadge style="font-size: 2px;"
                          severity="success"></span></button>
                      <h2 class="mb-1 title"> {{mail.title}} </h2>
                    </div>

                    <div class="d-flex align-items-center gap-3">
                      <i *ngIf="mail.starred" class="bi bi-star-fill star"></i>
                      <i *ngIf="mail.important" class="bi bi-exclamation-circle important"></i>
                      <span class="text-muted date"> {{mail.timestamp}} </span>
                    </div>
                  </div>
                  <div class="msg-title">
                    <h4> {{mail.sender}} </h4>
                  </div>
                  <div class="msg-content">
                    <p> {{mail.message}} </p>
                  </div>
                </div>
              </div>
              <div *ngIf="showPromotions" class="row messages-container w-100">
                <div *ngFor="let mail of promotionsMails" class="col-12 py-3 pe-3" (click)="selectMail(mail)"
                  [class.selected]="selectedMail === mail">
                  <div class="user d-flex justify-content-between align-items-center">
                    <div class="read-badge d-flex gap-1 justify-content-center align-items-center">
                      <button *ngIf="!mail.readed" (click)="markAsRead()" type="button" class="btn unreaded"
                        [pTooltip]="'Mark as read'" tooltipPosition="bottom"><span pBadge
                          style="font-size: 2px;"></span></button>
                      <button (click)="markAsUnread()" *ngIf="mail.readed" type="button" class="btn readed"
                        [pTooltip]="'Mark as unread'" tooltipPosition="bottom"><span pBadge style="font-size: 2px;"
                          severity="success"></span></button>
                      <h2 class="mb-1 title"> {{mail.title}} </h2>
                    </div>

                    <div class="d-flex align-items-center gap-3">
                      <i *ngIf="mail.starred" class="bi bi-star-fill star"></i>
                      <i *ngIf="mail.important" class="bi bi-exclamation-circle important"></i>
                      <span class="text-muted date"> {{mail.timestamp}} </span>
                    </div>
                  </div>
                  <div class="msg-title">
                    <h4> {{mail.sender}} </h4>
                  </div>
                  <div class="msg-content">
                    <p> {{mail.message}} </p>
                  </div>
                </div>
              </div>
              <div *ngIf="showForums" class="row messages-container w-100">
                <div *ngFor="let mail of forumsMails" class="col-12 py-3 pe-3" (click)="selectMail(mail)"
                  [class.selected]="selectedMail === mail">
                  <div class="user d-flex justify-content-between align-items-center">
                    <div class="read-badge d-flex gap-1 justify-content-center align-items-center">
                      <button *ngIf="!mail.readed" (click)="markAsRead()" type="button" class="btn unreaded"
                        [pTooltip]="'Mark as read'" tooltipPosition="bottom"><span pBadge
                          style="font-size: 2px;"></span></button>
                      <button (click)="markAsUnread()" *ngIf="mail.readed" type="button" class="btn readed"
                        [pTooltip]="'Mark as unread'" tooltipPosition="bottom"><span pBadge style="font-size: 2px;"
                          severity="success"></span></button>
                      <h2 class="mb-1 title"> {{mail.title}} </h2>
                    </div>

                    <div class="d-flex align-items-center gap-3">
                      <i *ngIf="mail.starred" class="bi bi-star-fill star"></i>
                      <i *ngIf="mail.important" class="bi bi-exclamation-circle important"></i>
                      <span class="text-muted date"> {{mail.timestamp}} </span>
                    </div>
                  </div>
                  <div class="msg-title">
                    <h4> {{mail.sender}} </h4>
                  </div>
                  <div class="msg-content">
                    <p> {{mail.message}} </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="selectedMail" class="col-md-7 col-sm-12">
        <div class="card msg-view mt-2">
          <div class="card-body m-3">

            <div class="btn-container dropdown d-flex justify-content-end mb-4">
              <div class="btn-group">
                <button (click)="markAsImportant()" type="button" class="btn" [pTooltip]="'Important'"
                  tooltipPosition="top"> <i class="bi bi-exclamation-circle" [ngClass]="{
                    'text-danger': selectedMail.important
                  }"></i> </button>
                <button type="button" [pTooltip]="'Select Tags'" tooltipPosition="top" class="btn dropdown-toggle"
                  data-bs-toggle="dropdown" aria-expanded="false">
                  <i class="bi bi-tag"></i>
                </button>
                <ul class="dropdown-menu">
                  <li *ngFor="let tag of tags" class="dropdown-item">
                    <div class="form-check">
                      <input (click)="updateMailTags(tag)" class="form-check-input" type="checkbox"
                        [(ngModel)]="tag.checked" id="flexCheckDefault">
                      <label class="form-check-label" for="flexCheckDefault">
                        {{tag.name}}
                      </label>
                    </div>
                  </li>
                </ul>
              </div>
              <button type="button" class="btn" [pTooltip]="'Print'" tooltipPosition="top"> <i
                  class="bi bi-printer"></i> </button>
              <button (click)="markAsTrash()" (click)="confirmDelete($event)" type="button" class="btn" [pTooltip]="'Delete'" tooltipPosition="top"> <i
                  class="bi bi-trash3"></i> </button>
              <p-toast></p-toast>
              <p-confirmDialog></p-confirmDialog>
            </div>
            <mat-divider></mat-divider>
            <div class="message mt-4">
              <div class="user-container d-flex align-items-center">
                <div class="img-container">
                  <img class="profile-picture" src="../../../assets/profile-picture.webp" alt="Profile Picture">
                </div>
                <div class="user-info w-100">
                  <div class="d-flex justify-content-between align-items-center">
                    <h1 class="mb-0">{{selectedMail?.sender}}</h1>
                    <span class="text-muted"> {{selectedMail?.timestamp}} </span>
                  </div>
                  <div class="d-flex justify-content-between align-items-center">
                    <span>To: {{selectedMail?.receiver}}
                      <small *ngIf="selectedMail.receiver2 && !selectedMail.receiver3">+1</small>
                      <small *ngIf="selectedMail.receiver2 && selectedMail.receiver3">+2</small>
                      <button class="btn arrow-btn" type="button" (click)="op.toggle($event)"> <i
                          class="bi bi-chevron-down"></i> </button>
                    </span>
                    <div class="btn-container">
                      <button (click)="markAsStarred()" class="btn" type="button" [pTooltip]="'Starred'"
                        tooltipPosition="top"> <i class="bi star" [ngClass]="{
                        'bi-star-fill': selectedMail.starred,
                        'bi-star': !selectedMail.starred
                      }"></i> </button>
                      <button class="btn" type="button" [pTooltip]="'Reply'" tooltipPosition="top"> <i
                          class="bi bi-reply"></i> </button>
                      <button class="btn" type="button" [pTooltip]="'Reply All'" tooltipPosition="top"> <i
                          class="bi bi-reply-all"></i> </button>
                      <button (click)="markAsSpam()" class="btn" type="button" [pTooltip]="'Spam'"
                        tooltipPosition="top"> <i class="bi bi-exclamation-triangle"
                          [ngClass]="{'text-danger': selectedMail.spam}"></i> </button>
                    </div>
                  </div>

                  <p-overlayPanel #op [dismissable]="true">
                    <div class="card">
                      <div class="card-body d-flex flex-column">
                        <span> <strong> from: </strong> {{selectedMail?.sender}} <small>
                            <{{selectedMail?.email}}>
                          </small> </span>
                        <span> <strong> to: </strong> {{selectedMail?.receiver}} <small>
                            <{{selectedMail?.receiverEmail}}>
                          </small></span>
                        <span *ngIf="selectedMail.receiver2"> <strong> cc: </strong> {{selectedMail?.receiver2}} <small>
                            <{{selectedMail?.receiverEmail2}}>
                          </small></span>
                        <span *ngIf="selectedMail.receiver3"> <strong> bcc: </strong> {{selectedMail?.receiver3}}
                          <small>
                            <{{selectedMail?.receiverEmail3}}>
                          </small></span>
                        <span> <strong> date: </strong> {{selectedMail?.timestamp}} </span>
                        <span> <strong> subject: </strong> {{selectedMail?.title}}</span>
                      </div>
                    </div>
                  </p-overlayPanel>

                </div>
              </div>
              <div class="msg-content">
                <div>
                  <div>
                    <div class="msg-title d-flex justify-content-between align-items-center">
                      <h3 class="title mb-0"> {{selectedMail.title}} </h3>
                      <div class="tags d-flex justify-content-end gap-2">
                        <span *ngFor="let tag of selectedMail?.tags">
                          <span class="badge rounded-pill p-2" [ngClass]="{
                              'bg-success text-success': tag === 'Promotions',
                              'bg-info text-info': tag=== 'Social',
                              'bg-warning text-warning': tag === 'Forums',
                              'bg-primary text-primary': tag === 'Personal',
                            }">{{tag}}</span>
                        </span>

                      </div>
                    </div>
                  </div>
                  <div>
                    {{selectedMail.message}}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
