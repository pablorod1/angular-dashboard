<section class="section">
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar -->
      <div class="col-lg-2 col-md-4 p-0">
        <div class="sidebar">
          <div class="header d-flex align-items-center">
            <img src="../../../assets/angular-logo.webp" alt="Angular Logo" class="logo">
            <h4 class="mb-0 title">Lucentia Cloud</h4>
          </div>
          <div class="body py-3">
            <ul class="list-unstyled">
              <li class="list-item" [ngClass]="{'active': showAllFiles && !showSelectedFolder}">
                <a role="button" (click)="backToAllFiles()"> <i class="me-2 bi bi-folder-fill"></i> File Manager </a>
              </li>
              <li class="list-item">
                <a role="button" (click)="openFolder('Favorites')"> <i class="me-2 bi bi-star-fill"></i> Favorite </a>
              </li>
              <li class="list-item">
                <a role="button" (click)="openFolder('Shared')"> <i class="me-2 bi bi-share-fill"></i> Shared </a>
              </li>
              <li class="list-item">
                <a role="button" (click)="openFolder('Trash')"> <i class="me-2 bi bi-trash3"></i> Trash </a>
              </li>
            </ul>
          </div>
          <mat-divider></mat-divider>
          <div class="footer">
            <ul class="list-unstyled">
              <li class="list-item">
                <a> <i class="me-2 bi bi-gear-fill"></i> Settings </a>
              </li>
              <li class="list-item d-flex justify-content-between align-items-center">
                <div>
                  <img #img src="../../../assets/profile-pictures/profile-picture.webp" alt="Profile Picture"
                    class="profile-picture me-2">
                  <span> Javier Mart√≠nez </span>
                </div>
              </li>
              <li>
                <small *ngIf="totalSize"> {{formatFileSize(totalSize)}} of 10Gb </small>
                <small *ngIf="!totalSize"> 0 Bytes of 10Gb </small>
                <p-meterGroup [max]="10737418240" [value]="totalSizeMeter"></p-meterGroup>
              </li>
            </ul>
          </div>
        </div>
      </div>
      <!-- File Manager Container -->
      <div class="col-lg-10 col-md-8 p-0">
        <div class="row">
          <div class="col-lg-8 col-md-7" [ngClass]="{
            'full-container' : !detailsActive,
          }">
            <div class="container-fluid file-manager-container px-0 py-3">
              <!-- Header Container -->
              <div class="header px-4 py-3">
                <button (click)="backToAllFiles()" type="button" class="btn back-icon"
                  *ngIf="showSelectedFolder"><i
                    class="bi bi-arrow-left text-dark"></i>
                </button>
                <div *ngIf="!showSelectedFolder" class="title-container">
                  <h2 class="title text-center"> Welcome to Lucentia Cloud </h2>
                </div>
                <div class="right-container">
                  <div *ngIf="!showSelectedFolder">
                    <input type="file" (change)="uploadFile($event)" #fileInput style="display: none;">
                    <button type="button" (click)="fileInput.click()" class="animated-button"><i
                        class="bi bi-upload"></i>
                      Upload File </button>
                  </div>

                  <button *ngIf="!detailsActive" type="button" (click)="detailsActive = !detailsActive"
                    class="btn info-btn"> <i class="bi bi-info-circle text-dark"></i></button>
                </div>
              </div>
              <div class="filters-container">
                <!-- Search -->
                <div class="search-container">
                  <input (change)="searchFile()" [(ngModel)]="searchQuery" type="text" id="searchInput"
                    class="form-control" placeholder="Search keyword" />
                </div>
                <p-multiSelect [showClear]="false" [options]="fileTypes" placeholder="Select File Type"
                  (onChange)="onSelectedTypesChange($event.value)" [(ngModel)]="selectedTypes">
                  <ng-template let-type pTemplate="selectedTypes">
                    <div class="multiselect-item">
                      <i class="bi" [ngClass]="getFileIcon(type)"></i>
                      <span> {{type}} </span>
                    </div>
                  </ng-template>
                </p-multiSelect>
              </div>
              <!-- Files Containers -->
              <div class="body py-4">
                <!-- All files -->
                <div *ngIf="showAllFiles" class="file-manager-body">

                  <!-- Filtered Type Files Container -->
                  <div *ngIf="filteredFiles.length > 0" class="files-container">
                    <p-divider align="left" type="solid"> Filtered Files </p-divider>
                    <div class="files">
                      <div *ngFor="let filteredFile of filteredFiles" (click)="selectFile(filteredFile)" #file
                        class="file">
                        <i class="bi" [ngClass]="getFileIcon(filteredFile.ext)"></i>
                        <span class="file-name" *ngIf="renamingFile !== filteredFile"> {{filteredFile.name}} </span>
                        <div *ngIf="renamingFile === filteredFile" class="form-group d-flex">
                          <input class="form-control" [(ngModel)]="filteredFile.name">
                          <button class="btn" (click)="saveRenameFile(filteredFile)"> <i
                              class="bi bi-check-lg text-success input-icon"></i> </button>
                          <button class="btn" (click)="cancelRenameFile()"> <i
                              class="bi bi-x-lg text-danger input-icon"></i> </button>
                        </div>
                        <p-contextMenu [model]="filesMenu" [target]="file"
                          (onShow)="selectedFile = filteredFile"></p-contextMenu>
                      </div>
                    </div>
                  </div>

                  <div *ngIf="filteredFiles.length === 0">
                    <!-- Folders Row -->
                    <div *ngIf="folders.length > 0 && showFolders && !showSelectedFolder" class="files-container">
                      <p-divider align="left" type="solid"> Folders </p-divider>
                      <div #foldersId class="folders">
                        <div *ngFor="let folder of folders">
                          <div
                            *ngIf="folder.name !== 'Trash' && folder.name !== 'Favorites' && folder.name !== 'Shared'"
                            pDroppable (onDrop)="dropFile(folder.name)" (click)="selectFolder(folder)"
                            (dblclick)="openFolder(folder.name)" class="folder">
                            <img src="../../../assets/icons/folder.svg" alt="Folder Icon" class="folder-icon">
                            <span><i class="bi {{folder.icon}} folder-icon"></i></span>
                            <span> {{folder.name}} </span>
                          </div>
                        </div>
                        <p-contextMenu [model]="folderMenu" [target]="foldersId"
                          (onShow)="selectedFile"></p-contextMenu>
                      </div>
                    </div>

                    <!-- All Files -->
                    <div *ngIf="files.length > 0 && !showSelectedFolder" class="files-container">
                      <p-divider align="left" type="solid"> Files </p-divider>
                      <div #file class="files">
                        <div *ngFor="let file of files" (click)="selectFile(file)" pDraggable (onDrag)="selectFile(file)"  #file class="file">
                          <i class="bi" [ngClass]="getFileIcon(file.ext)"></i>
                          <span class="file-name" *ngIf="renamingFile !== file"> {{file.name}} </span>
                          <div *ngIf="renamingFile === file" class="form-group d-flex">
                            <input class="form-control" [(ngModel)]="file.name">
                            <button class="btn" (click)="saveRenameFile(file)"> <i
                                class="bi bi-check-lg text-success input-icon"></i> </button>
                            <button class="btn" (click)="cancelRenameFile()"> <i
                                class="bi bi-x-lg text-danger input-icon"></i> </button>
                          </div>
                        </div>
                        <p-contextMenu [model]="filesMenu" [target]="file"
                          ></p-contextMenu>
                      </div>
                    </div>

                    <!-- Selected Folder Files -->
                    <div *ngIf="showSelectedFolder">
                      <p-divider align="left" type="solid"> {{selectedFolder?.name}} </p-divider>
                      <div #file class="files">
                        <div *ngFor="let file of files" pDraggable (click)="selectFile(file)" class="file">
                          <i class="bi" [ngClass]="getFileIcon(file.ext)"></i>
                          <span class="file-name" *ngIf="renamingFile !== file"> {{file.name}} </span>
                          <div *ngIf="renamingFile === file" class="form-group d-flex">
                            <input class="form-control" [(ngModel)]="file.name">
                            <button class="btn" (click)="saveRenameFile(file)"> <i
                                class="bi bi-check-lg text-success input-icon"></i> </button>
                            <button class="btn" (click)="cancelRenameFile()"> <i
                                class="bi bi-x-lg text-danger input-icon"></i> </button>
                          </div>
                        </div>
                        <p-contextMenu *ngIf="selectedFolder?.name === 'Trash'" [model]="trashMenu" [target]="file"
                          ></p-contextMenu>
                      </div>
                    </div>
                  </div>
                </div>

              </div>
            </div>
          </div>
          <div [@detailsAnimation]="detailsActive ? 'active' : 'inactive'" class="details col-lg-4 col-md-5 px-0">
            <!-- File // Folder Details When SelectedFile // SelectedFolder -->
            <div *ngIf="selectedFile || selectedFolder; else emptyDetails" class="container ps-0 p-4">
              <div class="details-header">
                <div *ngIf="selectedFile" class="file-title">
                  <i class="file-icon bi" [ngClass]="getFileIcon(selectedFile?.ext ?? '')"></i>
                  <h2 class="mb-0"> {{selectedFile.name}} </h2>
                </div>
                <div *ngIf="selectedFolder" class="file-title">
                  <i class="file-icon bi bi-folder-fill"></i>
                  <h2 class="mb-0"> {{selectedFolder.name}} </h2>
                </div>
                <button type="button" (click)="detailsActive = false" class="btn close-btn"> <i
                    class="bi bi-x text-dark"></i> </button>
              </div>
              <mat-divider></mat-divider>
              <div class="preview">
                <img *ngIf="selectedFile && selectedFile.imageUrl" [src]="selectedFile.imageUrl" alt=" Image Preview"
                  class="preview-img" loading="lazy">
              </div>
              <mat-divider></mat-divider>
              <div class="details-body">
                <div class="details-row">
                  <h3 class="mb-0"> Name: </h3>
                  <span *ngIf="selectedFile"> {{selectedFile.name}} </span>
                  <span *ngIf="selectedFolder"> {{selectedFolder.name}} </span>
                </div>
                <div class="details-row">
                  <h3 class="mb-0"> Type: </h3>
                  <span *ngIf="selectedFile"> {{getFileType(selectedFile?.ext ?? '')}} </span>
                  <span *ngIf="selectedFolder"> Folder </span>
                </div>
                <div class="details-row">
                  <h3 class="mb-0"> Size: </h3>
                  <span *ngIf="selectedFile"> {{formatFileSize(selectedFile.size)}} </span>
                  <span *ngIf="selectedFolder"> {{formatFileSize(selectedFolder.size)}} </span>
                </div>
                <div class="details-row">
                  <h3 class="mb-0"> Modified: </h3>
                  <span *ngIf="selectedFile"> {{selectedFile.modifiedOn}} </span>
                </div>
                <div *ngIf="selectedFile && selectedFile.folderName[0] !== ''" class="details-row">
                  <h3 class="mb-0"> Location: </h3>
                  <div class="location-btn-container d-flex flex-column gap-2">
                    <button *ngFor="let folder of selectedFile.folderName" type="button" (dblclick)="openFolder(folder)"
                      class="button">
                      <span>
                        <i class="me-2 bi bi-folder-fill"></i> {{folder}}
                      </span>
                    </button>
                  </div>
                </div>
                <div *ngIf="selectedFolder" class="details-row">
                  <h3 class="mb-0"> Files: </h3>
                  <span *ngIf="selectedFolder.files.length === 0"> No files </span>
                  <ul *ngIf="selectedFolder.files.length > 0" class="list-unstyled">
                    <li class="list-item" *ngFor="let file of selectedFolder.files">
                      <span> {{file.name}} </span>
                    </li>
                  </ul>
                </div>
              </div>
            </div>

            <!-- Empty Details When !SelectedFile && !SelectedFolder -->
            <ng-template #emptyDetails>
              <div class="btn-container d-flex justify-content-end me-3 mt-3">
                <button type="button" (click)="detailsActive = false" class="btn close-btn"> <i
                    class="bi bi-x text-dark"></i> </button>
              </div>
              <div class="container text-center ps-0 p-4">
                <img src="../../../assets/icons/search-file.webp" alt="Search Icon" class="search-img img-fluid">
                <div class="body py-5">
                  <h3 class="mb-0"> Select a file to view its details </h3>
                </div>
              </div>
            </ng-template>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Confirmation Dialog -->
  <p-confirmDialog></p-confirmDialog>

  <!-- Toast Notification -->
  <p-toast [position]="'bottom-right'"></p-toast>

  <!-- Create Folder Dialog -->
  <p-dialog [visible]="createFolderDialog" [modal]="true" closable="false">
    <ng-template pTemplate="headless">
      <div class="dialog-container bg-white p-4">
        <h4 class="mb-4"> Create Folder </h4>
        <div class="form-group">
          <label for="folderName"> Folder Name: </label>
          <input type="text" id="folderName" class="form-control" [(ngModel)]="newFolderName">
        </div>
        <div class="d-flex gap-2">
          <button type="button" class="button outline-danger text-danger" (click)="cancelCreateFolder()"> Cancel
          </button>
          <button type="button" class="button outline-success text-success" (click)="createFolder()"> Create </button>
        </div>
      </div>
    </ng-template>
  </p-dialog>

  <!-- Upload Dialog
  <p-dialog [visible]="showUploadDialog" [modal]="true" closable="false">
    <input type="file" (change)="previewUploadedFile($event)" multiple #fileInput style="display: none;">
    <ng-template pTemplate="headless">
      <div class="preview-file" *ngFor="let file of uploadedFiles">
        <img [src]="file.imageUrl" alt="File Preview" class="img-fluid">
        <div class="file-info">
          <h5 class="mb-0"> {{file.name}} </h5>
          <small> {{formatFileSize(file.size)}} </small>
        </div>
      </div>
      <div class="dialog-container bg-white p-4">
        <h4 class="mb-4"> Upload File </h4>
        <div class="d-flex gap-2">
          <button type="button" class="button outline-success text-success" (click)="fileInput.click()"> Upload </button>
        </div>
      </div>
    </ng-template>
  </p-dialog> -->
</section>
